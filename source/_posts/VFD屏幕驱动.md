---
title: VFD屏幕驱动
author: chi
avatar: 'https://cdn.jsdelivr.net/gh/nekocharm/cdn@1.0/img/custom/avatar.png'
authorLink: 'https://nekocharm.github.io'
authorAbout: 见贤思齐焉，见不贤而内自省也
authorDesc: 见贤思齐焉，见不贤而内自省也
categories: 技术
comments: true
date: 2021-05-27 22:52:23
tags:
keywords:
description:
photos: https://img.vim-cn.com/eb/10f65bedf3e44d9f5dee203f9ebbe4aa00af37.jpg
---

# 前言

最近买了一块VFD（真空荧光管），记录一下驱动的方法和遇到的问题。之前各种驱动都是一通抄例程然后改，然后遇到了这块屏幕，当然也给了例程，但因为给了官方文档，我就试着自己驱动一下试试，幸好前几天买了一个逻辑分析仪，让我第一次仔细研究了一下SPI的时序。

## 介绍

![](0.jpg)

实物图如上图所示，使用spi通信，但这块屏spi通信有点特殊，后文详细说明。

### 显示原理

阴极由多根钨丝组成，通电时会发射电子束。栅极是薄金属板制成的龟纹金属网。阳极制成要显示的图形的形状，并覆盖有荧光粉。通过电子束轰击阳极使荧光粉发光来显示不同字符。

### 通信协议

![](1.png)

![](2.png)

![](3.png)

官方手册里对spi的要求如上图，比较特殊的是数据是低位先行，这我还是第一次遇到。

# 驱动

## 启动后的流程

这里的前两个步骤都没有用到。

![](4.png)

## 寄存器说明

![](5.png)

这是官方文档中对寄存器的说明，下面对寄存器详细介绍。

### DCRAM数据写入命令

DCRAM（数据控制RAM）是直接控制显示的寄存器，通过写这个寄存器就能直接显示，X4-X0地址指的就是荧光管的位数，这个荧光管有八位，所有有效地址为20H-27H。

第一个字节，选定该模式并指定地址X4-X0，设定初始地址。

| B7   | B6   | B5   | B4   | B3   | B2   | B1   | B0   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 0    | 0    | 1    | X4   | X3   | X2   | X1   | X0   |

第二个字节，开始写入要显示的字符编码，此编码为CGROM和CGRAM里的编码。

| B7   | B6   | B5   | B4   | B3   | B2   | B1   | B0   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| C7   | C6   | C5   | C4   | C3   | C2   | C1   | C0   |

可以继续写第三个字节，第四个字节，地址会自动加一，当超过有效地址后写入的字节无效。

### CGRAM数据写入命令

CGRAM是用户自定义的字库，用户可以在里面写入自己的字库。

第一个字节，选定地址Y2-Y0，用户自定义字库共有8个用三位地址线指定。

| B7   | B6   | B5   | B4   | B3   | B2   | B1   | B0   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 0    | 1    | 0    | *    | *    | Y2   | Y1   | Y0   |

第二个字节，写入字库字模第一列，该荧光管每一位5x7，故最高位无效。

| B7   | B6   | B5   | B4   | B3   | B2   | B1   | B0   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| *    | D30  | D25  | D20  | D15  | D10  | D5   | D0   |

剩下字节同第二字节，共需要写入5行。若继续写入数据则地址自动加一，存入下一个位置。

### ADRAM数据写入命令

ADRAM（附加数据RAM），这个似乎是用来显示附加字符的，这块荧光管似乎没有附加字符。

### 亮度设置命令

第一个字节，进入亮度设置。

| B7   | B6   | B5   | B4   | B3   | B2   | B1   | B0   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1    | 1    | 1    | 0    | 0    | 1    | *    | *    |

第二个字节，亮度等级00H-FFH，但是具体亮度官方文档介绍如下图。

| B7   | B6   | B5   | B4   | B3   | B2   | B1   | B0   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| H7   | H6   | H5   | H4   | H3   | H2   | H1   | H0   |

### 显示控制命令

| B7   | B6   | B5   | B4   | B3   | B2   | B1   | B0   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1    | 1    | 1    | 0    | 1    | 0    | LS   | HS   |

LS=0，HS=0时正常显示。LS=1，HS=0时关闭，在上电或重启时为关闭状态。其他情况为全部亮，不推荐使用。

### 待机模式命令

| B7   | B6   | B5   | B4   | B3   | B2   | B1   | B0   |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1    | 1    | 1    | 0    | 1    | 1    | *    | ST   |

ST=0正常显示，ST=1待机模式



