---
title: 荔枝派烧录系统
author: chi
avatar: 'https://cdn.jsdelivr.net/gh/nekocharm/cdn@1.0/img/custom/avatar.png'
authorLink: https://nekocharm.github.io
authorAbout: 见贤思齐焉，见不贤而内自省也
authorDesc: 见贤思齐焉，见不贤而内自省也
categories: 技术
comments: true
date: 2021-05-20 17:20:00
tags:
keywords:
description:
photo: https://img.vim-cn.com/bd/eb08fa1c05937ec3ae0aa1b97122b4582bcfc5.png
---

# 安装工具并创建分区

## 在linux虚拟机里安装GParted

```bash
sudo apt-get install gparted
```

## 创建分区

uboot需要烧录到8k偏移处，需在前面空出一部分空间

按下图创建分区

![](1.png)

# 烧录系统

## 烧录uboot

使用dd将编译好的uboot烧录到内存卡，编译好的文件就在uboot所在的目录下

```bash
sudo dd if=u-boot-sunxi-with-spl.bin of=/dev/sdb bs=1024 seek=8
```

## 复制zImage和设备树文件到fat16分区

> zImage文件位于linux文件夹下的arch/arm/boot/文件夹中
>
> dtb文件位于linux文件夹下的arch/arm/boot/dts/文件夹中

## 复制根文件系统

将处理好的根文件系统直接复制到ext4分区里

# 启动测试

将usb转ttl连接到uart0

在uboot启动时按任意键

![](2.png)

修改环境变量bootargs和bootcmd，从内存卡启动

```
setenv bootargs "console=ttyS0,115200 panic=5 rootwait mtdparts=spi32766.0:1M(uboot)ro,64k(dtb)ro,6M(kernel)ro,-(rootfs) root=/dev/mmcblk0p2 earlyprintk rw"
setenv bootcmd "setenv bootm_boot_mode sec; load mmc 0:1 0x41000000 zImage;load mmc 0:1 0x41800000 sun8i-v3s-licheepi-zero-dock.dtb;bootz 0x41000000 - 0x41800000; "
saveenv
```

输入`boot`进入系统

![](3.png)

